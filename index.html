<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Web Editor</title>
    <link rel="stylesheet" href="src/ui/styles.css">
    
    <!-- Three.js Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/TransformControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
</head>
<body>
    <div id="app">
        <!-- Main Toolbar -->
        <div class="toolbar" id="main-toolbar">
            <div class="toolbar-group">
                <button class="tool-btn" id="new-scene" title="New Scene">üìÑ</button>
                <button class="tool-btn" id="open-scene" title="Open Scene">üìÇ</button>
                <button class="tool-btn" id="save-scene" title="Save Scene">üíæ</button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" id="undo" title="Undo">‚Ü∂</button>
                <button class="tool-btn" id="redo" title="Redo">‚Ü∑</button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" id="move-tool" title="Move Tool">‚Üî</button>
                <button class="tool-btn" id="rotate-tool" title="Rotate Tool">üîÑ</button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" id="import-model" title="Import 3D Model">üìÅ</button>
                <button class="tool-btn" id="plugin-manager-btn" title="Plugin Manager">üß©</button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" id="grid-toggle" title="Toggle Grid">‚äû</button>
                <button class="tool-btn" id="fullscreen-toggle" title="Fullscreen">‚õ∂</button>
            </div>
            
            <div class="toolbar-group">
                <button class="tool-btn" id="play-scene" title="Play Scene">‚ñ∂</button>
                <button class="tool-btn" id="pause-scene" title="Pause Scene">‚è∏</button>
                <button class="tool-btn" id="stop-scene" title="Stop Scene">‚èπ</button>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Sidebar -->
            <div class="sidebar" id="left-sidebar">
                <!-- Scene Hierarchy Panel -->
                <div class="panel" id="hierarchy-panel">
                    <div class="panel-header">
                        <h3>Scene Hierarchy</h3>
                    </div>
                    <div class="panel-content">
                        <div id="hierarchy-list">
                            <p>No objects in scene</p>
                        </div>
                    </div>
                </div>

                <!-- Components Panel -->
                <div class="panel" id="component-panel">
                    <div class="panel-header">
                        <h3>Components</h3>
                    </div>
                    <div class="panel-content">
                        <div id="component-list">
                            <div class="component-item" draggable="true" data-component="Script">
                                <span class="component-icon">üìú</span>
                                <span class="component-name">Script</span>
                            </div>
                            <div class="component-item" draggable="true" data-component="Collider">
                                <span class="component-icon">üõ°</span>
                                <span class="component-name">Collider</span>
                            </div>
                            <div class="component-item" draggable="true" data-component="Light">
                                <span class="component-icon">üí°</span>
                                <span class="component-name">Light</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Viewport -->
            <div class="viewport" id="viewport">
                <div class="viewport-overlay">
                    <div class="viewport-info">
                        <span id="viewport-stats">Objects: 0 | FPS: 60</span>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="sidebar" id="right-sidebar">
                <!-- Inspector Panel -->
                <div class="panel" id="inspector-panel">
                    <div class="panel-header">
                        <h3>Inspector</h3>
                    </div>
                    <div class="panel-content">
                        <div id="inspector-content">
                            <p>Select an object to inspect</p>
                        </div>
                    </div>
                </div>

                <!-- Console Panel -->
                <div class="panel" id="console-panel">
                    <div class="panel-header">
                        <h3>Console</h3>
                        <button id="clear-console" title="Clear Console">üóë</button>
                    </div>
                    <div class="panel-content">
                        <div id="console-output"></div>
                        <div class="console-input">
                            <input type="text" id="console-input" placeholder="Enter command...">
                            <button id="console-submit">‚ñ∂</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Plugin Manager Modal -->
    <div id="plugin-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <span>Plugin Manager</span>
          <button class="modal-close" onclick="document.getElementById('plugin-modal').classList.add('hidden')">√ó</button>
        </div>
        <div class="modal-body">
          <div class="plugin-manager-tabs">
            <button class="tab-btn active" data-tab="installed">Installed Plugins</button>
            <button class="tab-btn" data-tab="available">Available Plugins</button>
          </div>
          
          <div class="tab-content active" id="installed-tab">
            <div id="installed-plugins">
              <p>Loading installed plugins...</p>
            </div>
          </div>
          
          <div class="tab-content" id="available-tab">
            <div id="available-plugins">
              <p>Loading available plugins...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Plugin Manager Modal -->

    <!-- Core Scripts -->
    <script src="src/core/EventBus.js"></script>
    <script src="src/core/SceneManager.js"></script>
    <script src="src/core/ComponentSystem.js"></script>
    <script src="src/core/AssetManager.js"></script>
    <script src="src/core/EditorCore.js"></script>
    <script src="src/core/PluginManager.js"></script>
    <script src="src/ui/UIManager.js"></script>
    
    <!-- Main Application Script -->
    <script>
        // Override console.log to capture output
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            if (consoleOutput) {
                const timestamp = new Date().toLocaleTimeString();
                const color = type === 'error' ? '#ff0000' : type === 'warn' ? '#ffff00' : '#00ff00';
                const div = document.createElement('div');
                div.innerHTML = `<span style="color: #888888;">[${timestamp}]</span> <span style="color: ${color};">${message}</span>`;
                consoleOutput.appendChild(div);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
            }
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsole(args.join(' '), 'warn');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };
        
        // Initialize editor
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                console.log('Initializing 3D Web Editor...');
                
                // Create core systems
                const eventBus = new EventBus();
                const sceneManager = new SceneManager(eventBus);
                const componentSystem = new ComponentSystem(eventBus);
                const assetManager = new AssetManager(eventBus);
                
                // Create editor core
                const editorCore = new EditorCore(eventBus, sceneManager, componentSystem, assetManager);
                EditorCore.setInstance(editorCore);
                
                // Initialize editor (this will also initialize UI)
                await editorCore.init();
                
                console.log('Editor initialization complete');
                
                // Setup global references for UI functions
                window.uiManager = editorCore.uiManager;
                
                // UIManager and EditorCore already attach toolbar handlers
                // Remove duplicate inline handlers to avoid double events
                
            } catch (error) {
                console.error('Failed to initialize editor:', error);
            }
        });
        
        // Removed inline setupEventHandlers; UI is managed by classes
    </script>
</body>
</html>

